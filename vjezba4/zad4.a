CTCR	EQU		0FFFF0000
CTLR	EQU		0FFFF0004
CTCLR	EQU		0FFFF0008
CTEND	EQU		0FFFF000C

DMASRC	EQU		0FFFF1000
DMADEST	EQU		0FFFF1004
DMASIZE	EQU		0FFFF1008
DMACTRL	EQU		0FFFF100C
DMASTAR	EQU		0FFFF1010
DMAACK	EQU		0FFFF1014

BVJ 	EQU		0FFFFFFFC

		ORG 	0
		MOVE	10000, SP
		JP		GLAVNI
		
		;prekidni potprogram
		ORG 	0C
		PUSH 	R0
		MOVE 	SR, R0
		PUSH 	R0
		PUSH 	R1
		;STORE	R0, (CTCLR)
		STORE	R0, (DMAACK)
		LOAD	R0, (ADRESA)
		ADD		R0, 24, R0
		MOVE	-1, R1
		STORE	R1, (R0)
		ADD		R0, 4, R0
		STORE	R0, (ADRESA)
		LOAD	R0, (BLOKOVI)
		ADD		R0, 1, R0
		STORE	R0, (BLOKOVI)
		POP		R1
		POP		R0
		MOVE 	R0, SR
		POP 	R0
		
		RETN
		
GLAVNI	MOVE 	%D 1000, R0
		STORE 	R0, (CTLR)
		MOVE	%B 01, R0
		STORE 	R0, (CTCR) ;pokreni brojanje
PETLJA	LOAD 	R0, (BLOKOVI)
		CMP 	R0, 5
		JP_EQ	KRAJ
CHECK	LOAD	R0, (CTCLR)
		CMP 	R0, 0
		JP_EQ	PETLJA
		;inace inicializacija DMA
INIT	STORE 	R0, (CTCLR)
		MOVE 	BVJ, R0
		STORE	R0, (DMASRC)
		LOAD 	R0, (ADRESA)
		STORE	R0, (DMADEST)
		MOVE 	9, R0
		STORE	R0, (DMASIZE)
		MOVE 	%B 0111, R0
		STORE 	R0, (DMACTRL)
RUNDMA	STORE	R0, (DMASTAR); pokretanje DMA prijenosa
		STORE	R0, (CTEND)
		JP		PETLJA

KRAJ	MOVE 	0, R0
		STORE	R0, (CTCR)
		STORE	R0, (DMACTRL)
		HALT
		
BLOKOVI	DW		0
ADRESA 	DW		1000